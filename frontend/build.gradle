plugins {
    id 'java'
    id "com.github.node-gradle.node" version "2.2.4"
}

node {
    download = true
    version = '15.6.0'
}

task testFront(type: NpxTask, dependsOn: 'npmInstall') {
  command = 'ng'
  args = ['build']
  inputs.files('package.json', 'package-lock.json', 'angular.json', 'tsconfig.json', 'tsconfig.app.json')
  inputs.dir('src')
  inputs.dir(fileTree("node_modules").exclude(".cache"))
  outputs.dir('dist')
  args = ['test']
  inputs.files('package.json', 'package-lock.json', 'angular.json', 'tsconfig.json', 'tsconfig.app.json')
  inputs.dir('src')
  inputs.dir(fileTree("node_modules").exclude(".cache"))
  outputs.dir('dist')
}

task buildAngularApp(type: NpxTask, dependsOn: 'npmInstall') {
  command = 'ng'
  args = ['build', '--prod']
  inputs.files('package.json', 'package-lock.json', 'angular.json', 'tsconfig.json', 'tsconfig.app.json')
  inputs.dir('src')
  inputs.dir(fileTree("node_modules").exclude(".cache"))
  outputs.dir('dist')
}

check.dependsOn testFront

jar {
    dependsOn buildAngularApp
    from 'dist/restaurant-review' into 'static'
}
